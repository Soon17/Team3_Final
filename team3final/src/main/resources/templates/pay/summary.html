<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="UTF-8">
  <style>
    .pay-summary-box {
      position: fixed;
      width: 410px;
      z-index: 10;
      background-color: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }

    .mobile-pay-footer {
      display: none;
      /* PC에서는 안 보이게 */
    }

    @media (max-width: 1080px) {
      .pay-summary-box {
        display: none;
      }

      .mobile-pay-footer {
        display: flex;
        justify-content: center;
        align-items: center;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 77px;
        background: #fff;
        padding: 0 16px;
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
        z-index: 1000;
      }

      .mobile-pay-button {
        background: #007Bff;
        border-radius: 5px;
        width: 77.3%;
        height: 80%;
        align-content: center;
        text-align: center;
        padding: 12px 12px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.03);
        cursor: pointer;
      }

      .mobile-pay-button strong {
        font-weight: bold;
        font-size: 17px;
        color: #fff;
        display: block;
      }

      .mobile-pay-button .desc {
        font-size: 12px;
        color: #666;
        margin-top: 4px;
      }

      .mx-5 {
        margin-left: 0.5rem !important;
        margin-right: 0.5rem !important;
      }

      .check-box .text-center {
        flex: 1;
      }
    }
  </style>
</head>

<body>
  <main layout:fragment="content" class="mb-5">
    <div class="col-md-5 col-12">
      <div class="pay-summary-box">
        <h5 class="mb-4">결제 정보</h5>

        <!-- 화살표 포함 총 상품금액 영역 -->
        <div class="d-flex justify-content-between mb-2" style="cursor: pointer;" onclick="toggleDetailAll()">
          <div class="text-muted">총 상품금액</div>
          <div class="d-flex align-items-center" style="gap: 4px;">
            <div class="font-weight-bold">66,000원</div>
            <img class="arrowImg" src="/resources/static/imgs/small-up.png" width="16" height="16" />
          </div>
        </div>

        <!-- 상세 요금 -->
        <div class="priceDetail" style="display: none; font-size: 13px;">
          <div class="d-flex justify-content-between bg-light p-2 rounded mb-2">
            <div class="text-muted">1박 숙박 요금</div>
            <div class="text-muted">33,000원</div>
          </div>
        </div>
        <hr>
        <div class="d-flex justify-content-between mt-3 mb-3">
          <strong>총 결제금액</strong>
          <strong>66,000원</strong>
        </div>
        <button class="btn btn-primary btn-block">결제하기</button>
      </div>
    </div>
  </main>

  <!-- 하단 고정 모바일 결제 박스 -->
  <div class="mobile-pay-footer">
    <div class="mobile-pay-button" onclick="goPayment()">
      <strong>267,810원 바로 결제하기</strong>
    </div>
  </div>

  <script>
    function toggleDetailAll() {
      const $details = $(".priceDetail");
      const $arrows = $(".arrowImg");

      detailVisible = !detailVisible;

      if (detailVisible) {
        $details.slideDown(200);
        $arrows.attr("src", "/resources/static/imgs/small-up.png");
      } else {
        $details.slideUp(200);
        $arrows.attr("src", "/resources/static/imgs/small-down.png");
      }
    }

    $(document).ready(function () {
      $(".priceDetail").slideDown(0);
      $(".arrowImg").attr("src", "/resources/static/imgs/small-up.png");

      // 모바일 하단 금액 텍스트 자동 반영
      const total = $(".pay-summary-box strong").last().text();
      $(".mobile-pay-footer strong").text(`${total} 바로 결제하기`);

      $(".btn.btn-primary, .mobile-pay-button").on("click", function (e) {
        let hasError = false;

        const nameRegex = /^[가-힣a-zA-Z]{2,20}$/;
        const phoneRegex = /^01[016789]-\d{3,4}-\d{4}$/;

        const reserverName = $("input[name='reserverName']");
        const reserverPhone = $("input[name='reserverPhone']");
        const guestName = $("input[name='guestName']");
        const guestPhone = $("input[name='guestPhone']");
        const sameInfo = $("#sameInfo").is(":checked");

        // 예약자 이름
        if (!nameRegex.test(reserverName.val().trim())) {
          alert("[예약자 정보 > 이름] 이름을 정확하게 입력해 주세요.");
          reserverName.addClass("is-invalid").focus();
          e.preventDefault();
          return;
        } else {
          reserverName.removeClass("is-invalid");
        }

        // 예약자 번호
        if (!phoneRegex.test(reserverPhone.val().trim())) {
          alert("[예약자 정보 > 휴대폰 번호] 휴대폰 번호를 입력해 주세요.");
          reserverPhone.addClass("is-invalid").focus();
          e.preventDefault();
          return;
        } else {
          reserverPhone.removeClass("is-invalid");
        }

        if (!sameInfo) {
          // 숙박자 이름
          if (!nameRegex.test(guestName.val().trim())) {
            alert("[숙박자 정보 > 이름] 이름을 정확하게 입력해 주세요.");
            guestName.addClass("is-invalid").focus();
            e.preventDefault();
            return;
          } else {
            guestName.removeClass("is-invalid");
          }

          // 숙박자 번호
          if (!phoneRegex.test(guestPhone.val().trim())) {
            alert("[숙박자 정보 > 휴대폰 번호] 휴대폰 번호를 입력해 주세요.");
            guestPhone.addClass("is-invalid").focus();
            e.preventDefault();
            return;
          } else {
            guestPhone.removeClass("is-invalid");
          }
        }
      });
    });
  </script>
</body>

</html>